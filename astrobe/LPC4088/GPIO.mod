MODULE GPIO;

(* Abstract bitwise GPIO services *)

(* $Id$ *)

(* Copyright (C)2014-2015, Philip Munts, President, Munts AM Corp.             *)
(*                                                                             *)
(* Redistribution and use in source and binary forms, with or without          *)
(* modification, are permitted provided that the following conditions are met: *)
(*                                                                             *)
(* * Redistributions of source code must retain the above copyright notice,    *)
(*   this list of conditions and the following disclaimer.                     *)
(*                                                                             *)
(* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" *)
(* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE   *)
(* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  *)
(* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE   *)
(* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR         *)
(* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF        *)
(* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS    *)
(* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN     *)
(* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)     *)
(* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  *)
(* POSSIBILITY OF SUCH DAMAGE.                                                 *)

(* These services provide a simple and efficient mechanism for software to     *)
(* control individual GPIO pins in an asynchronous fashion, where each GPIO    *)
(* pin is independent of any other.  This API is NOT suitable for situations   *)
(* where GPIO pins are grouped in buses.                                       *)
(*                                                                             *)
(* GPIO pins are numbered sequentially from the least significant bit of the   *)
(* lowest GPIO port to the highest port and bit.  For example, if an MCU has   *)
(* two 8-bit GPIO ports, the GPIO pins would be numbered GPIO0 to GPIO15.      *)

(* Each GPIO pin has two constants defined for it: DirN and PinN.  These map   *)
(* to Cortex-Mx bitband registers for that particular GPIO pin.                *)

CONST
  Dir0*   = 23300000H;  Pin0*   = 23300280H;     (* Port 0 bit 0  *)
  Dir1*   = 23300004H;  Pin1*   = 23300284H;     (* Port 0 bit 1  *)
  Dir2*   = 23300008H;  Pin2*   = 23300288H;     (* Port 0 bit 2  *)
  Dir3*   = 2330000CH;  Pin3*   = 2330028CH;     (* Port 0 bit 3  *)
  Dir4*   = 23300010H;  Pin4*   = 23300290H;     (* Port 0 bit 4  *)
  Dir5*   = 23300014H;  Pin5*   = 23300294H;     (* Port 0 bit 5  *)
  Dir6*   = 23300018H;  Pin6*   = 23300298H;     (* Port 0 bit 6  *)
  Dir7*   = 2330001CH;  Pin7*   = 2330029CH;     (* Port 0 bit 7  *)
  Dir8*   = 23300020H;  Pin8*   = 233002A0H;     (* Port 0 bit 8  *)
  Dir9*   = 23300024H;  Pin9*   = 233002A4H;     (* Port 0 bit 9  *)
  Dir10*  = 23300028H;  Pin10*  = 233002A8H;     (* Port 0 bit 10 *)
  Dir11*  = 2330002CH;  Pin11*  = 233002ACH;     (* Port 0 bit 11 *)
  Dir12*  = 23300030H;  Pin12*  = 233002B0H;     (* Port 0 bit 12 *)
  Dir13*  = 23300034H;  Pin13*  = 233002B4H;     (* Port 0 bit 13 *)
  Dir14*  = 23300038H;  Pin14*  = 233002B8H;     (* Port 0 bit 14 *)
  Dir15*  = 2330003CH;  Pin15*  = 233002BCH;     (* Port 0 bit 15 *)
  Dir16*  = 23300040H;  Pin16*  = 233002C0H;     (* Port 0 bit 16 *)
  Dir17*  = 23300044H;  Pin17*  = 233002C4H;     (* Port 0 bit 17 *)
  Dir18*  = 23300048H;  Pin18*  = 233002C8H;     (* Port 0 bit 18 *)
  Dir19*  = 2330004CH;  Pin19*  = 233002CCH;     (* Port 0 bit 19 *)
  Dir20*  = 23300050H;  Pin20*  = 233002D0H;     (* Port 0 bit 20 *)
  Dir21*  = 23300054H;  Pin21*  = 233002D4H;     (* Port 0 bit 21 *)
  Dir22*  = 23300058H;  Pin22*  = 233002D8H;     (* Port 0 bit 22 *)
  Dir23*  = 2330005CH;  Pin23*  = 233002DCH;     (* Port 0 bit 23 *)
  Dir24*  = 23300060H;  Pin24*  = 233002E0H;     (* Port 0 bit 24 *)
  Dir25*  = 23300064H;  Pin25*  = 233002E4H;     (* Port 0 bit 25 *)
  Dir26*  = 23300068H;  Pin26*  = 233002E8H;     (* Port 0 bit 26 *)
  Dir27*  = 2330006CH;  Pin27*  = 233002ECH;     (* Port 0 bit 27 *)
  Dir28*  = 23300070H;  Pin28*  = 233002F0H;     (* Port 0 bit 28 *)
  Dir29*  = 23300074H;  Pin29*  = 233002F4H;     (* Port 0 bit 29 *)
  Dir30*  = 23300078H;  Pin30*  = 233002F8H;     (* Port 0 bit 30 *)
  Dir31*  = 2330007CH;  Pin31*  = 233002FCH;     (* Port 0 bit 31 *)

  Dir32*  = 23300400H;  Pin32*  = 23300680H;     (* Port 1 bit 0  *)
  Dir33*  = 23300404H;  Pin33*  = 23300684H;     (* Port 1 bit 1  *)
  Dir34*  = 23300408H;  Pin34*  = 23300688H;     (* Port 1 bit 2  *)
  Dir35*  = 2330040CH;  Pin35*  = 2330068CH;     (* Port 1 bit 3  *)
  Dir36*  = 23300410H;  Pin36*  = 23300690H;     (* Port 1 bit 4  *)
  Dir37*  = 23300414H;  Pin37*  = 23300694H;     (* Port 1 bit 5  *)
  Dir38*  = 23300418H;  Pin38*  = 23300698H;     (* Port 1 bit 6  *)
  Dir39*  = 2330041CH;  Pin39*  = 2330069CH;     (* Port 1 bit 7  *)
  Dir40*  = 23300420H;  Pin40*  = 233006A0H;     (* Port 1 bit 8  *)
  Dir41*  = 23300424H;  Pin41*  = 233006A4H;     (* Port 1 bit 9  *)
  Dir42*  = 23300428H;  Pin42*  = 233006A8H;     (* Port 1 bit 10 *)
  Dir43*  = 2330042CH;  Pin43*  = 233006ACH;     (* Port 1 bit 11 *)
  Dir44*  = 23300430H;  Pin44*  = 233006B0H;     (* Port 1 bit 12 *)
  Dir45*  = 23300434H;  Pin45*  = 233006B4H;     (* Port 1 bit 13 *)
  Dir46*  = 23300438H;  Pin46*  = 233006B8H;     (* Port 1 bit 14 *)
  Dir47*  = 2330043CH;  Pin47*  = 233006BCH;     (* Port 1 bit 15 *)
  Dir48*  = 23300440H;  Pin48*  = 233006C0H;     (* Port 1 bit 16 *)
  Dir49*  = 23300444H;  Pin49*  = 233006C4H;     (* Port 1 bit 17 *)
  Dir50*  = 23300448H;  Pin50*  = 233006C8H;     (* Port 1 bit 18 *)
  Dir51*  = 2330044CH;  Pin51*  = 233006CCH;     (* Port 1 bit 19 *)
  Dir52*  = 23300450H;  Pin52*  = 233006D0H;     (* Port 1 bit 20 *)
  Dir53*  = 23300454H;  Pin53*  = 233006D4H;     (* Port 1 bit 21 *)
  Dir54*  = 23300458H;  Pin54*  = 233006D8H;     (* Port 1 bit 22 *)
  Dir55*  = 2330045CH;  Pin55*  = 233006DCH;     (* Port 1 bit 23 *)
  Dir56*  = 23300460H;  Pin56*  = 233006E0H;     (* Port 1 bit 24 *)
  Dir57*  = 23300464H;  Pin57*  = 233006E4H;     (* Port 1 bit 25 *)
  Dir58*  = 23300468H;  Pin58*  = 233006E8H;     (* Port 1 bit 26 *)
  Dir59*  = 2330046CH;  Pin59*  = 233006ECH;     (* Port 1 bit 27 *)
  Dir60*  = 23300470H;  Pin60*  = 233006F0H;     (* Port 1 bit 28 *)
  Dir61*  = 23300474H;  Pin61*  = 233006F4H;     (* Port 1 bit 29 *)
  Dir62*  = 23300478H;  Pin62*  = 233006F8H;     (* Port 1 bit 30 *)
  Dir63*  = 2330047CH;  Pin63*  = 233006FCH;     (* Port 1 bit 31 *)
 
  Dir64*  = 23300800H;  Pin64*  = 23300A80H;     (* Port 2 bit 0  *)
  Dir65*  = 23300804H;  Pin65*  = 23300A84H;     (* Port 2 bit 1  *)
  Dir66*  = 23300808H;  Pin66*  = 23300A88H;     (* Port 2 bit 2  *)
  Dir67*  = 2330080CH;  Pin67*  = 23300A8CH;     (* Port 2 bit 3  *)
  Dir68*  = 23300810H;  Pin68*  = 23300A90H;     (* Port 2 bit 4  *)
  Dir69*  = 23300814H;  Pin69*  = 23300A94H;     (* Port 2 bit 5  *)
  Dir70*  = 23300818H;  Pin70*  = 23300A98H;     (* Port 2 bit 6  *)
  Dir71*  = 2330081CH;  Pin71*  = 23300A9CH;     (* Port 2 bit 7  *)
  Dir72*  = 23300820H;  Pin72*  = 23300AA0H;     (* Port 2 bit 8  *)
  Dir73*  = 23300824H;  Pin73*  = 23300AA4H;     (* Port 2 bit 9  *)
  Dir74*  = 23300828H;  Pin74*  = 23300AA8H;     (* Port 2 bit 10 *)
  Dir75*  = 2330082CH;  Pin75*  = 23300AACH;     (* Port 2 bit 11 *)
  Dir76*  = 23300830H;  Pin76*  = 23300AB0H;     (* Port 2 bit 12 *)
  Dir77*  = 23300834H;  Pin77*  = 23300AB4H;     (* Port 2 bit 13 *)
  Dir78*  = 23300838H;  Pin78*  = 23300AB8H;     (* Port 2 bit 14 *)
  Dir79*  = 2330083CH;  Pin79*  = 23300ABCH;     (* Port 2 bit 15 *)
  Dir80*  = 23300840H;  Pin80*  = 23300AC0H;     (* Port 2 bit 16 *)
  Dir81*  = 23300844H;  Pin81*  = 23300AC4H;     (* Port 2 bit 17 *)
  Dir82*  = 23300848H;  Pin82*  = 23300AC8H;     (* Port 2 bit 18 *)
  Dir83*  = 2330084CH;  Pin83*  = 23300ACCH;     (* Port 2 bit 19 *)
  Dir84*  = 23300850H;  Pin84*  = 23300AD0H;     (* Port 2 bit 20 *)
  Dir85*  = 23300854H;  Pin85*  = 23300AD4H;     (* Port 2 bit 21 *)
  Dir86*  = 23300858H;  Pin86*  = 23300AD8H;     (* Port 2 bit 22 *)
  Dir87*  = 2330085CH;  Pin87*  = 23300ADCH;     (* Port 2 bit 23 *)
  Dir88*  = 23300860H;  Pin88*  = 23300AE0H;     (* Port 2 bit 24 *)
  Dir89*  = 23300864H;  Pin89*  = 23300AE4H;     (* Port 2 bit 25 *)
  Dir90*  = 23300868H;  Pin90*  = 23300AE8H;     (* Port 2 bit 26 *)
  Dir91*  = 2330086CH;  Pin91*  = 23300AECH;     (* Port 2 bit 27 *)
  Dir92*  = 23300870H;  Pin92*  = 23300AF0H;     (* Port 2 bit 28 *)
  Dir93*  = 23300874H;  Pin93*  = 23300AF4H;     (* Port 2 bit 29 *)
  Dir94*  = 23300878H;  Pin94*  = 23300AF8H;     (* Port 2 bit 30 *)
  Dir95*  = 2330087CH;  Pin95*  = 23300AFCH;     (* Port 2 bit 31 *)

  Dir96*  = 23300C00H;  Pin96*  = 23300E80H;     (* Port 3 bit 0  *)
  Dir97*  = 23300C04H;  Pin97*  = 23300E84H;     (* Port 3 bit 1  *)
  Dir98*  = 23300C08H;  Pin98*  = 23300E88H;     (* Port 3 bit 2  *)
  Dir99*  = 23300C0CH;  Pin99*  = 23300E8CH;     (* Port 3 bit 3  *)
  Dir100* = 23300C10H;  Pin100* = 23300E90H;     (* Port 3 bit 4  *)
  Dir101* = 23300C14H;  Pin101* = 23300E94H;     (* Port 3 bit 5  *)
  Dir102* = 23300C18H;  Pin102* = 23300E98H;     (* Port 3 bit 6  *)
  Dir103* = 23300C1CH;  Pin103* = 23300E9CH;     (* Port 3 bit 7  *)
  Dir104* = 23300C20H;  Pin104* = 23300EA0H;     (* Port 3 bit 8  *)
  Dir105* = 23300C24H;  Pin105* = 23300EA4H;     (* Port 3 bit 9  *)
  Dir106* = 23300C28H;  Pin106* = 23300EA8H;     (* Port 3 bit 10 *)
  Dir107* = 23300C2CH;  Pin107* = 23300EACH;     (* Port 3 bit 11 *)
  Dir108* = 23300C30H;  Pin108* = 23300EB0H;     (* Port 3 bit 12 *)
  Dir109* = 23300C34H;  Pin109* = 23300EB4H;     (* Port 3 bit 13 *)
  Dir110* = 23300C38H;  Pin110* = 23300EB8H;     (* Port 3 bit 14 *)
  Dir111* = 23300C3CH;  Pin111* = 23300EBCH;     (* Port 3 bit 15 *)
  Dir112* = 23300C40H;  Pin112* = 23300EC0H;     (* Port 3 bit 16 *)
  Dir113* = 23300C44H;  Pin113* = 23300EC4H;     (* Port 3 bit 17 *)
  Dir114* = 23300C48H;  Pin114* = 23300EC8H;     (* Port 3 bit 18 *)
  Dir115* = 23300C4CH;  Pin115* = 23300ECCH;     (* Port 3 bit 19 *)
  Dir116* = 23300C50H;  Pin116* = 23300ED0H;     (* Port 3 bit 20 *)
  Dir117* = 23300C54H;  Pin117* = 23300ED4H;     (* Port 3 bit 21 *)
  Dir118* = 23300C58H;  Pin118* = 23300ED8H;     (* Port 3 bit 22 *)
  Dir119* = 23300C5CH;  Pin119* = 23300EDCH;     (* Port 3 bit 23 *)
  Dir120* = 23300C60H;  Pin120* = 23300EE0H;     (* Port 3 bit 24 *)
  Dir121* = 23300C64H;  Pin121* = 23300EE4H;     (* Port 3 bit 25 *)
  Dir122* = 23300C68H;  Pin122* = 23300EE8H;     (* Port 3 bit 26 *)
  Dir123* = 23300C6CH;  Pin123* = 23300EECH;     (* Port 3 bit 27 *)
  Dir124* = 23300C70H;  Pin124* = 23300EF0H;     (* Port 3 bit 28 *)
  Dir125* = 23300C74H;  Pin125* = 23300EF4H;     (* Port 3 bit 29 *)
  Dir126* = 23300C78H;  Pin126* = 23300EF8H;     (* Port 3 bit 30 *)
  Dir127* = 23300C7CH;  Pin127* = 23300EFCH;     (* Port 3 bit 31 *)

  Dir128* = 23301000H;  Pin128* = 23301280H;     (* Port 4 bit 0  *)
  Dir129* = 23301004H;  Pin129* = 23301284H;     (* Port 4 bit 1  *)
  Dir130* = 23301008H;  Pin130* = 23301288H;     (* Port 4 bit 2  *)
  Dir131* = 2330100CH;  Pin131* = 2330128CH;     (* Port 4 bit 3  *)
  Dir132* = 23301010H;  Pin132* = 23301290H;     (* Port 4 bit 4  *)
  Dir133* = 23301014H;  Pin133* = 23301294H;     (* Port 4 bit 5  *)
  Dir134* = 23301018H;  Pin134* = 23301298H;     (* Port 4 bit 6  *)
  Dir135* = 2330101CH;  Pin135* = 2330129CH;     (* Port 4 bit 7  *)
  Dir136* = 23301020H;  Pin136* = 233012A0H;     (* Port 4 bit 8  *)
  Dir137* = 23301024H;  Pin137* = 233012A4H;     (* Port 4 bit 9  *)
  Dir138* = 23301028H;  Pin138* = 233012A8H;     (* Port 4 bit 10 *)
  Dir139* = 2330102CH;  Pin139* = 233012ACH;     (* Port 4 bit 11 *)
  Dir140* = 23301030H;  Pin140* = 233012B0H;     (* Port 4 bit 12 *)
  Dir141* = 23301034H;  Pin141* = 233012B4H;     (* Port 4 bit 13 *)
  Dir142* = 23301038H;  Pin142* = 233012B8H;     (* Port 4 bit 14 *)
  Dir143* = 2330103CH;  Pin143* = 233012BCH;     (* Port 4 bit 15 *)
  Dir144* = 23301040H;  Pin144* = 233012C0H;     (* Port 4 bit 16 *)
  Dir145* = 23301044H;  Pin145* = 233012C4H;     (* Port 4 bit 17 *)
  Dir146* = 23301048H;  Pin146* = 233012C8H;     (* Port 4 bit 18 *)
  Dir147* = 2330104CH;  Pin147* = 233012CCH;     (* Port 4 bit 19 *)
  Dir148* = 23301050H;  Pin148* = 233012D0H;     (* Port 4 bit 20 *)
  Dir149* = 23301054H;  Pin149* = 233012D4H;     (* Port 4 bit 21 *)
  Dir150* = 23301058H;  Pin150* = 233012D8H;     (* Port 4 bit 22 *)
  Dir151* = 2330105CH;  Pin151* = 233012DCH;     (* Port 4 bit 23 *)
  Dir152* = 23301060H;  Pin152* = 233012E0H;     (* Port 4 bit 24 *)
  Dir153* = 23301064H;  Pin153* = 233012E4H;     (* Port 4 bit 25 *)
  Dir154* = 23301068H;  Pin154* = 233012E8H;     (* Port 4 bit 26 *)
  Dir155* = 2330106CH;  Pin155* = 233012ECH;     (* Port 4 bit 27 *)
  Dir156* = 23301070H;  Pin156* = 233012F0H;     (* Port 4 bit 28 *)
  Dir157* = 23301074H;  Pin157* = 233012F4H;     (* Port 4 bit 29 *)
  Dir158* = 23301078H;  Pin158* = 233012F8H;     (* Port 4 bit 30 *)
  Dir159* = 2330107CH;  Pin159* = 233012FCH;     (* Port 4 bit 31 *)

  Dir160* = 23301400H;  Pin160* = 23301680H;     (* Port 5 bit 0  *)
  Dir161* = 23301404H;  Pin161* = 23301684H;     (* Port 5 bit 1  *)
  Dir162* = 23301408H;  Pin162* = 23301688H;     (* Port 5 bit 2  *)
  Dir163* = 2330140CH;  Pin163* = 2330168CH;     (* Port 5 bit 3  *)
  Dir164* = 23301410H;  Pin164* = 23301690H;     (* Port 5 bit 4  *)
  Dir165* = 23301414H;  Pin165* = 23301694H;     (* Port 5 bit 5  *)
  Dir166* = 23301418H;  Pin166* = 23301698H;     (* Port 5 bit 6  *)
  Dir167* = 2330141CH;  Pin167* = 2330169CH;     (* Port 5 bit 7  *)
  Dir168* = 23301420H;  Pin168* = 233016A0H;     (* Port 5 bit 8  *)
  Dir169* = 23301424H;  Pin169* = 233016A4H;     (* Port 5 bit 9  *)
  Dir170* = 23301428H;  Pin170* = 233016A8H;     (* Port 5 bit 10 *)
  Dir171* = 2330142CH;  Pin171* = 233016ACH;     (* Port 5 bit 11 *)
  Dir172* = 23301430H;  Pin172* = 233016B0H;     (* Port 5 bit 12 *)
  Dir173* = 23301434H;  Pin173* = 233016B4H;     (* Port 5 bit 13 *)
  Dir174* = 23301438H;  Pin174* = 233016B8H;     (* Port 5 bit 14 *)
  Dir175* = 2330143CH;  Pin175* = 233016BCH;     (* Port 5 bit 15 *)
  Dir176* = 23301440H;  Pin176* = 233016C0H;     (* Port 5 bit 16 *)
  Dir177* = 23301444H;  Pin177* = 233016C4H;     (* Port 5 bit 17 *)
  Dir178* = 23301448H;  Pin178* = 233016C8H;     (* Port 5 bit 18 *)
  Dir179* = 2330144CH;  Pin179* = 233016CCH;     (* Port 5 bit 19 *)
  Dir180* = 23301450H;  Pin180* = 233016D0H;     (* Port 5 bit 20 *)
  Dir181* = 23301454H;  Pin181* = 233016D4H;     (* Port 5 bit 21 *)
  Dir182* = 23301458H;  Pin182* = 233016D8H;     (* Port 5 bit 22 *)
  Dir183* = 2330145CH;  Pin183* = 233016DCH;     (* Port 5 bit 23 *)
  Dir184* = 23301460H;  Pin184* = 233016E0H;     (* Port 5 bit 24 *)
  Dir185* = 23301464H;  Pin185* = 233016E4H;     (* Port 5 bit 25 *)
  Dir186* = 23301468H;  Pin186* = 233016E8H;     (* Port 5 bit 26 *)
  Dir187* = 2330146CH;  Pin187* = 233016ECH;     (* Port 5 bit 27 *)
  Dir188* = 23301470H;  Pin188* = 233016F0H;     (* Port 5 bit 28 *)
  Dir189* = 23301474H;  Pin189* = 233016F4H;     (* Port 5 bit 29 *)
  Dir190* = 23301478H;  Pin190* = 233016F8H;     (* Port 5 bit 30 *)
  Dir191* = 2330147CH;  Pin191* = 233016FCH;     (* Port 5 bit 31 *)

(* Data direction constants *)

  INPUT*  = 0;
  OUTPUT* = 1;
  
(* Logic level constants *)

  HIGH*   = 1;
  LOW*    = 0;
  ON*     = 1;
  OFF*    = 0;
  
BEGIN
END GPIO.
